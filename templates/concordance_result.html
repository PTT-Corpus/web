{% extends 'base.html' %}
{% load paging %}
{% load pos %}


{% block extra_css %}
<style>
em {
  color: red;
  font-weight: bold;
}
.info {
  font-size: 12px;
  margin-bottom: 0;
}
.info .material-icons {
  font-size: 12px;
}

.info > .col {
  padding: .3rem .75rem;
}

.badg {
  font-size: 0.8rem;
  font-weight: 300;
  color: #fff;
  background-color: #26a69a;
  border-radius: 2px;
  padding: 0 6px;
  text-align: center;
  box-sizing: border-box;
  float: left;
  margin-top: 3px;
  margin-right: 6px;
}

.pos {
  font-size: 0.8rem;
  font-weight: 300;
  color: #0288d1;
  /* background-color: #00acc1; */
  /* border-radius: 20px; */
  /* padding: 0 6px; */
  text-align: center;
  box-sizing: border-box;
  margin: 0 12px 0 2px;
  /* vertical-align: super; */
  position: relative;
  top: -.5em;
}

.highlight .col {
  line-height: 2em;
}

.highlight .right-align {
  padding: 0;
}

.highlight .left-align {
  padding: 0;
}

</style>
{% endblock extra_css %}

{% block main_title %}
Concordance
{% endblock main_title%}

{% block main_content %}

<h5>你的搜尋</h5>
<div class="row grey lighten-4">
  <div class="col s4">
    <p><span class="badg">Query word</span> {{ query.word }}</p>
    <p><span class="badg">Boards</span>{{ query.boards }}</p>
    <p><span class="badg">Post type</span>{{ query.post_type }}</p>
    
  </div>
  <div class="col s4">
    <p><span class="badg">Sorting</span>{{ query.sort }}</p>
    <p><span class="badg">Order</span>{{ query.order }}</p>
    <p><span class="badg">Part of speech</span>{% if query.pos %}On{% else %}Off     
    {% endif %}</p>
    
  </div>
  <div class="col s4">
    <p><span class="badg">Window size</span>{{ query.window_size }}</p>
    <p><span class="badg">Item per page</span>{{ query.size }}</p>
    <p><span class="badg">Date interval</span>{{ query.start }}-{{ query.end }}</p>
  </div>
</div>
<h5>結果總筆數: {{ data.total }}</h5>

 <table class="highlight">
  <thead>
    <tr>
        <th></th>
    </tr>
  </thead>

  <tbody>
    {% for d in data.data %}
      <tr>
        <td style="padding-bottom: 0">
          <div class="row" style="margin-bottom: 1em">
            <div class="col s5 right-align">
                {% if query.pos %}
                  {{ d.concordance.0|pos }}
                {% else %}
                  {{ d.concordance.0 }}
                {% endif %}
            </div>
            <div class="col s1 center-align">
              {% if query.pos %}
                  {{ d.concordance.1|safe|pos }}
                {% else %}
                  {{ d.concordance.1|safe }}
                {% endif %}
            </div>
            <div class="col s6 left-align">
              {% if query.pos %}
                  {{ d.concordance.2|pos }}
                {% else %}
                  {{ d.concordance.2 }}
                {% endif %}
            </div>
          </div>
          <div class="row info">

            <div class="col m4">
            </div>
            <div class="col m4 s12 grey lighten-2">
              <span>[{{ d.board }}] {{ d.published }}</span>
            </div>

            {% if d.type == None %}
              <div class="col m1 s3 grey lighten-3">
                <i class="material-icons">thumb_up</i>
                <span>{{ d.upvote }}</span>
              </div>
              <div class="col m1 s3 grey lighten-3">
                <i class="material-icons">thumb_down</i>
                <span>{{ d.downvote }}</span>
              </div>
              <div class="col m1 s3 grey lighten-3">
                <i class="material-icons">arrow_forward</i>
                <span>{{ d.novote }}</span>
              </div>
            {% else %}
              <div class="col m3 s9 grey lighten-3 right-align">
                <span>{{ d.type }}</span>
              </div>
            {% endif %}
            <div class="col m1 s3 grey lighten-3">
              <span><a href="https://www.ptt.cc/bbs/{{ d.board }}/{% if d.post_id%}{{ d.post_id }}{% else %}{{d.id}}{% endif %}.html" target="_blank">
                <i class="material-icons">link</i>
              </a>
              </span>
            </div>
          </div>
        </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<br>
{% paginator as pages %}
{% paging_prev as pp %}
{% paging_next as pg %}
<ul class="pagination center-align">
  <li class="{% if pp is None %}disabled{% else %}waves-effect{% endif %}">
    <a href="javascript:;" onclick="paginator({{ pp }})"><i class="material-icons">chevron_left</i></a>
  </li>
  {% for page in pages %}
    <li class="waves-effect {% if data.page == page %}active{% endif %}">
      <a href="javascript:;" onclick="paginator({{ page }});">{{ page|add:1 }}</a>
    </li>
  {% endfor %}
  <li class="{% if pg is None %}disabled{% else %}waves-effect{% endif %}">
    <a href="javascript:;" onclick="paginator({{ pg }})"><i class="material-icons">chevron_right</i></a>
  </li>
</ul>

<form method="post" class="hide" id="_form">
  {% csrf_token %}
  {{ form }}
</form>
{% endblock main_content %}

{% block extra_js %}
<script>
function paginator(page) {
  document.getElementById("{{ form.page.auto_id }}").value = page;
  document.getElementById("_form").submit();
};
var d = {{data}};
console.log(d);
</script>
{% endblock extra_js %}
